library(ggplot2)
library(e1071)
library(dplyr)
library(plotly)
library(magrittr)


# The data in this document gives the number of meals eaten that contain fish (per week) and mercury levels in head hair for 100 fisherman.  
# Save the data to a format that can be read into R.  Read the data in for analysis.  
# Use R to calculate the quantities and generate the visual summaries requested below.


# (1) Save the data to a file  (excel or CSV file) and read it into R memory for analysis. (Q1 -  2 points)

setwd("C:/Users/patry/OneDrive/Desktop")

# Assign the .csv information to a dataframe
df = read.csv("homework3.csv", header=T, sep=",", fileEncoding="UTF-8-BOM", stringsAsFactors = F)
df

# (2) To get a sense of the data, generate a scatterplot (using an appropriate window, label the axes, and title the graph). 
# Consciously decide which variable should be on the  -axis and which should be on the y-axis.  
# Using the scatterplot, describe the form, direction, and strength of the association between the variables. (Q2 - 3 points)

library(plotly)

x <- list(
  title = "# of Fish Meals")
y <- list(
  title = "Mercury Level (Hg)")

plot.1 <- df %>% 
  plot_ly(x = df$Number.of.meals.with.fish, trace ="scatter", mode="markers") %>% 
  add_markers(y = df$Total.Mercury.in.mg.g, name="Observation") %>% 
  layout(xaxis = x, yaxis = y)

plot.1



# (3) Calculate the correlation coefficient.  What does the correlation tell us? (Q3 - 2 points)

cor(df$Number.of.meals.with.fish, df$Total.Mercury.in.mg.g)


# The correlation  is a measure of the strength and direction of a linear relationship between two quantative variables in a sample.
# In this case, the correlation tells us that there is a strong relationship between a fish-heavy diet, and the presense of mercuray in the sample groups hair.


# (4) Find the equation of the least squares regression equation, and write out the equation.  
# Add the regression line to the scatterplot you generated above. (Q4 - 4 points)



# load linear model and predict trend line
df$trend=trend.line
df

model <- lm(Total.Mercury.in.mg.g ~ Number.of.meals.with.fish, data = df)




# Add trend line top revious plot

x <- list(
  title = "# of Fish Meals")
y <- list(
  title = "Mercury Level (Hg)")

plot.2 <- df %>% 
  plot_ly(x = df$Number.of.meals.with.fish) %>% 
  add_markers(y = df$Total.Mercury.in.mg.g, name="Observation") %>% 
  add_lines( y = fitted(model), name="Beta.1 Projection") %>%
  layout(xaxis = x, yaxis = y)

plot.2


# print intercept and slope
model
coef(model)

# (Intercept) Number.of.meals.with.fish 
# 1.6876426                 0.2759503 



# (5) What is the estimate for   beta_1 ?   How can we interpret this value?  What is the estimate for  beta_0 ?  
#   What is the interpretation of this value?  (Q5 - 4 points)

# The estimate for beta.1 is the slope of the projected trendline (0.2759)
# It is interpretable as the line that minimizes the residuals for each observation in our dataset.

# The Beta.0 value is the location where the projected trendline intersects with the y axis.
# It is interpretable as the value that our model will predict when our x input is 0.
# I.e. given the linear model's current state, we would expect to predict a mercury level of 1.68 for individuals who have eaten 0 meals with fish.





# (6) Calculate the ANOVA table and the table which gives the standard error of    (hat beta 1) . 
# Formally test the hypothesis that beta_1 = 0 using either the F-test or the t-test at the  alpha level a=0.10.  Either way, present your results using the 5 step procedure as in the course notes.  Within your conclusion, calculate the R2    (R  squared) value and interpret this.  
# Also, calculate and interpret the 90% confidence interval for  beta_1  .   (Q6 -  5 points)

summary(model)
anova(model)



# 1) Set up the hypothesis and select the alpha level
# H0: B1 == 0
# H1: B1 != 0
# alpha = 0.10

# 2) Select the appropriate test statistic


# 3) State the decision rule. 
# F = Reg MS / Res MS; with 
# df = 1, 99

qf(0.90, df1=1, df2=99)

# Decision rule:
#Reject H0 if F>= 2.756899


#4) 

# The sum of squared errors is sum(anova.table$residuals^2).
# The mean squared error is  mean(anoval.table$residuals^2)

anova.table <- anova(model)
anova.table

pf(93.68853, df1=1, df2=98, lower.tail=F)

ms.reg <- anova.table$"Mean Sq"[1]
ms.reg

ms.res <- anova.table$'Mean Sq'[2]
ms.res

f <- ms.reg/ms.res
f  # 93.68853

# Reject H0 since 93.68853 >= 2.756899.
# We have significant evidence at the a=0.10 level that b.1 !=0.
# E.g. there is evidence of a significant linear association between a fish-based diet and mercury levels.


